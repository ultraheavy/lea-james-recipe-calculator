<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <title>{% block title %}Lea Jane's Recipe Calculator{% endblock %}</title>
    
    <!-- Modern Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- CSS Files -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/design-system.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/modern-ui.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/food-icons.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/responsive-navigation.css') }}?v={{ range(1, 10000) | random }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/mobile-buttons.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/responsive-tables.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/table-sort.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/view-switcher.css') }}">
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='20' fill='%236366f1'/><text y='65' x='50' text-anchor='middle' font-size='60' fill='white'>LJ</text></svg>">
    
    {% block extra_head %}{% endblock %}
</head>
<body class="theme-modern">
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container">
            <div class="navbar-content">
                <a href="/" class="navbar-brand">
                    <div class="navbar-logo">LJ</div>
                    <span>Lea Jane's</span>
                </a>
                
                <button class="mobile-menu-toggle" onclick="toggleMobileMenu()">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 12h18M3 6h18M3 18h18"/>
                    </svg>
                </button>
                
                <div class="navbar-menu" id="navbarMenu">
                    <!-- Mobile Menu Header -->
                    <div class="mobile-menu-header mobile-only">
                        <div class="navbar-logo" style="width: 40px; height: 40px; font-size: 1rem;">LJ</div>
                        <button class="mobile-menu-close" onclick="closeMobileMenu()">Ã—</button>
                    </div>
                    
                    <!-- Navigation Links -->
                    <a href="/" class="navbar-link {% if request.endpoint == 'index' %}active{% endif %}">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/>
                            <path d="M9 22V12h6v10"/>
                        </svg>
                        <span>Dashboard</span>
                    </a>
                    
                    <a href="/inventory" class="navbar-link {% if request.endpoint == 'inventory' %}active{% endif %}">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M20 7H4a2 2 0 00-2 2v9a2 2 0 002 2h16a2 2 0 002-2V9a2 2 0 00-2-2z"/>
                            <path d="M20 7V5a2 2 0 00-2-2H6a2 2 0 00-2 2v2"/>
                        </svg>
                        <span>Inventory</span>
                    </a>
                    
                    <a href="/recipes" class="navbar-link {% if request.endpoint == 'recipes' %}active{% endif %}">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/>
                            <path d="M14 2v6h6M16 13H8m8 4H8m2-8H8"/>
                        </svg>
                        <span>Recipes</span>
                    </a>
                    
                    
                    <a href="/menus_mgmt" class="navbar-link {% if request.endpoint == 'menus' or request.endpoint == 'edit_menu' %}active{% endif %}">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M4 6h16M4 12h16M4 18h16"/>
                        </svg>
                        <span>Menus</span>
                    </a>
                    
                    <a href="/pricing-analysis" class="navbar-link {% if request.endpoint == 'pricing_analysis' %}active{% endif %}">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M22 12h-4l-3 9L9 3l-3 9H2"/>
                        </svg>
                        <span>Analytics</span>
                    </a>
                    
                    <a href="/vendors" class="navbar-link {% if request.endpoint == 'vendors' %}active{% endif %}">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/>
                            <circle cx="9" cy="7" r="4"/>
                        </svg>
                        <span>Vendors</span>
                    </a>
                    
                    <a href="/admin/inventory-staging/" class="navbar-link {% if 'inventory-staging' in request.path %}active{% endif %}">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M9 11H4a2 2 0 00-2 2v7a2 2 0 002 2h5m6-11h5a2 2 0 012 2v7a2 2 0 01-2 2h-5m-6-11V4a2 2 0 012-2h4a2 2 0 012 2v7m-6 0h6"/>
                        </svg>
                        <span>Import Review</span>
                    </a>
                    
                    <!-- Theme Selector in Mobile Menu -->
                    <div class="mobile-only theme-dots">
                        <a href="/set-theme/modern" class="theme-dot active" title="Modern" style="background: #6366f1;"></a>
                        <a href="/set-theme/neo" class="theme-dot" title="Neo Tokyo" style="background: linear-gradient(135deg, #ff006e, #00f5ff);"></a>
                        <a href="/set-theme/fam" class="theme-dot" title="FAM Hospitality" style="background: #4DB6AC;"></a>
                    </div>
                </div>
                
                <!-- Desktop Theme Switcher -->
                <div class="desktop-only" style="margin-left: auto;">
                    <select onchange="window.location.href='/set-theme/' + this.value" class="theme-selector">
                        <option value="modern" selected>Modern Theme</option>
                        <option value="neo">Neo Tokyo</option>
                        <option value="fam">FAM Hospitality</option>
                    </select>
                </div>
                
                <!-- Mobile Menu Backdrop (inside nav for proper stacking) -->
                <div class="mobile-menu-backdrop" id="mobileMenuBackdrop" onclick="closeMobileMenu()"></div>
            </div>
        </div>
    </nav>
    
    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        <div class="alert alert-{{ category }} animate-slide-down mb-4">
                            {% if category == 'success' %}
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M20 6L9 17l-5-5"/>
                                </svg>
                            {% elif category == 'danger' or category == 'error' %}
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"/>
                                    <path d="M12 8v4m0 4h.01"/>
                                </svg>
                            {% else %}
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"/>
                                    <path d="M12 16v-4m0-4h.01"/>
                                </svg>
                            {% endif %}
                            {{ message }}
                        </div>
                    {% endfor %}
                {% endif %}
            {% endwith %}
            
            {% block content %}{% endblock %}
        </div>
    </main>
    
    <!-- Theme Toggle -->
    <div class="theme-toggle">
        <button class="theme-toggle-btn" onclick="toggleTheme()" title="Toggle theme">
            <svg class="sun-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="5"/>
                <path d="M12 1v6m0 6v6m-9-9h6m6 0h6M5.64 5.64l3.54 3.54m7.64 7.64l3.54 3.54M5.64 18.36l3.54-3.54m7.64-7.64l3.54-3.54"/>
            </svg>
            <svg class="moon-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display:none;">
                <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/>
            </svg>
        </button>
    </div>
    
    <!-- Scripts -->
    <script src="{{ url_for('static', filename='js/icons.js') }}"></script>
    <script>
        // Mobile menu toggle
        function toggleMobileMenu() {
            const menu = document.getElementById('navbarMenu');
            const backdrop = document.getElementById('mobileMenuBackdrop');
            menu.classList.toggle('active');
            backdrop.classList.toggle('active');
            
            // Prevent body scroll when menu is open
            if (menu.classList.contains('active')) {
                document.body.style.overflow = 'hidden';
            } else {
                document.body.style.overflow = '';
            }
        }
        
        // Close mobile menu
        function closeMobileMenu() {
            const menu = document.getElementById('navbarMenu');
            const backdrop = document.getElementById('mobileMenuBackdrop');
            menu.classList.remove('active');
            backdrop.classList.remove('active');
            document.body.style.overflow = '';
        }
        
        // Theme toggle
        function toggleTheme() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            
            // Toggle icons
            const sunIcon = document.querySelector('.sun-icon');
            const moonIcon = document.querySelector('.moon-icon');
            if (newTheme === 'dark') {
                sunIcon.style.display = 'none';
                moonIcon.style.display = 'block';
            } else {
                sunIcon.style.display = 'block';
                moonIcon.style.display = 'none';
            }
        }
        
        // Load saved theme
        document.addEventListener('DOMContentLoaded', function() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            
            if (savedTheme === 'dark') {
                document.querySelector('.sun-icon').style.display = 'none';
                document.querySelector('.moon-icon').style.display = 'block';
            }
        });
        
        // Close mobile menu on click outside
        document.addEventListener('click', function(event) {
            const menu = document.getElementById('navbarMenu');
            const toggle = document.querySelector('.mobile-menu-toggle');
            const backdrop = document.getElementById('mobileMenuBackdrop');
            if (!menu.contains(event.target) && !toggle.contains(event.target)) {
                closeMobileMenu();
            }
        });
        
        // Close mobile menu with Escape key
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeMobileMenu();
            }
        });
        
        // Responsive table handling
        document.addEventListener('DOMContentLoaded', function() {
            // Check if tables are scrollable and add indicators
            const tableContainers = document.querySelectorAll('.table-container');
            tableContainers.forEach(container => {
                const table = container.querySelector('.table');
                if (table && container.scrollWidth > container.clientWidth) {
                    container.classList.add('has-scroll');
                    
                    // Add scroll hint
                    const hint = document.createElement('div');
                    hint.className = 'table-scroll-hint';
                    hint.innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 5l7 7-7 7"/></svg>';
                    container.appendChild(hint);
                    
                    // Remove hint on scroll
                    container.addEventListener('scroll', function() {
                        if (container.scrollLeft > 10) {
                            container.classList.add('scrolled');
                        } else {
                            container.classList.remove('scrolled');
                        }
                    }, { passive: true });
                }
            });
        });
    </script>
    
    {% block extra_scripts %}{% endblock %}
    
    <style>
        /* Additional styles for main content */
        .main-content {
            min-height: calc(100vh - 70px);
            padding: 2rem 0;
        }
        
        /* Mobile menu styles */
        @media (max-width: 768px) {
            .navbar-menu span {
                display: none;
            }
            
            .navbar-link {
                padding: 0.75rem;
            }
            
            .navbar-link svg {
                width: 24px;
                height: 24px;
            }
        }
    </style>
    
    <!-- Table Sorting Scripts -->
    <script src="{{ url_for('static', filename='js/table-sort.js') }}"></script>
    <script src="{{ url_for('static', filename='js/table-sort-init.js') }}"></script>
    <script src="{{ url_for('static', filename='js/view-switcher.js') }}"></script>
</body>
</html>